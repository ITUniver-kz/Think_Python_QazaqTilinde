---
title: Қателер
isFree: True
---

# 22. Exceptions

## 22.1. Ерекшеліктер 
Орындау уақытының қатесі орын алған сайын, ол ерекше жағдай нысанын жасайды. Бағдарлама осы сәтте жұмысын тоқтатады және Python кері бақылауды басып шығарады, ол орын алған ерекше жағдайды сипаттайтын хабарламамен аяқталады.

Мысалы, нөлге бөлу ерекше жағдайды жасайды:

```python
>>> print(55/0)
Traceback (most recent call last):
  File "<interactive input>", line 1, in <module>
ZeroDivisionError: integer division or modulo by zero
```

Сондай-ақ жоқ тізім элементіне қол жеткізу:

```python
>>> a = []
>>> print(a[5])
Traceback (most recent call last):
  File "<interactive input>", line 1, in <module>
IndexError: list index out of range
```

Немесе кортежде элемент тапсырмасын жасауға әрекеттену:

```python
>>> tup = ("a", "b", "d", "d")
>>> tup[2] = "c"
Traceback (most recent call last):
  File "<interactive input>", line 1, in <module>
TypeError: 'tuple' object does not support item assignment
```

Әрбір жағдайда соңғы жолдағы қате туралы хабар екі бөліктен тұрады: қос нүктенің алдындағы қате түрі және қос нүктеден кейінгі қате туралы ерекшеліктер.

Кейде біз ерекше жағдай тудыруы мүмкін операцияны орындағымыз келеді, бірақ бағдарламаның тоқтағанын қаламаймыз. Код аймағын «орау» үшін try операторы арқылы ерекше жағдайды өңдей аламыз .

Мысалы, пайдаланушыдан файлдың атын сұрап, оны ашуға тырысуымыз мүмкін. Егер файл жоқ болса, біз бағдарламаның бұзылуын қаламаймыз; біз ерекше жағдайды шешкіміз келеді:

```python
filename = input("Enter a file name: ")
try:
    f = open(filename, "r")
except:
    print("There is no file named", filename)
```

try операторында try ... қоспағанда ... finally кілт сөздерімен енгізілген үш бөлек сөйлем немесе бөліктер бар . Excor немесе finally сөйлемдерін өткізіп жіберуге болады, сондықтан жоғарыдағы код алдымен try операторының ең көп тараған нұсқасын қарастырады .

try операторы бірінші блоктағы операторларды орындайды және бақылайды . Ешбір ерекшеліктер болмаса, ол except тармағының астындағы блокты өткізіп жібереді. Кез келген ерекшелік орын алса, ол except тармағындағы мәлімдемелерді орындайды, содан кейін жалғастырады.

Біз бұл мүмкіндікті функцияға инкапсуляциялай аламыз: exists ол файл атауын қабылдайды және файл бар болса ақиқат, жоқ болса жалған мәнін қайтарады:

```python
def exists(filename):
    try:
        f = open(filename)
        f.close()
        return True
    except:
        return False
```

Ерекшеліктерді қолданбай, файлдың бар-жоғын тексеруге арналған үлгі

Біз жаңа ғана көрсеткен функция біз ұсынатын функция емес. Ол файлды ашады және жабады, ол семантикалық тұрғыдан «ол бар ма?» Деген сұрақтан ерекшеленеді. Қалай? Біріншіден, ол файлдағы кейбір уақыт белгілерін жаңартуы мүмкін. Екіншіден, егер қандай да бір басқа бағдарламада файл ашылған болса немесе рұқсат параметрлеріміз файлды ашуға мүмкіндік бермесе, ол бізге мұндай файл жоқ екенін айтуы мүмкін.

Python os модулі ішінде os.path деп аталатын модульді қамтамасыз етеді . Ол жолдармен, файлдармен және каталогтармен жұмыс істеу үшін бірқатар пайдалы функцияларды қамтамасыз етеді, сондықтан анықтаманы қарап шығу керек.

```python
import os

# Бұл файлдың бар-жоғын тексерудің қолайлы жолы. 
if os.path.isfile("c:/temp/testdata.txt"):
   ...
```

Ерекшеліктердің әртүрлі түрлерін өңдеу үшін біз бірнеше қоспағанда сөйлемдерді пайдалана аламыз (ерекшеліктерді толық талқылау үшін Python жасаушысы Гвидо ван Россумның Python оқулығының Қателер мен ерекшеліктер сабағын қараңыз). Сонымен, егер файл жоқ болса, бағдарлама бір нәрсені жасай алады, бірақ файлды басқа бағдарлама пайдаланған болса, басқа әрекетті орындауы мүмкін.

## 22.2. Өзіміздің ерекше жағдайларымызды көтеру

Біздің бағдарлама әдейі өзінің ерекше жағдайларын тудыруы мүмкін бе? Егер бағдарламамыз қате жағдайын анықтаса, біз ерекше жағдай жасай аламыз . Міне, пайдаланушыдан енгізуді алатын және санның теріс емес екенін тексеретін мысал:

```python
def get_age():
    age = int(input("Please enter your age: "))
    if age < 0:
        # Create a new instance of an exception
        my_error = ValueError("{0} is not a valid age".format(age))
        raise my_error
    return age
```

5-жол ерекше жағдай нысанын жасайды, бұл жағдайда қате туралы нақты ақпаратты инкапсуляциялайтын ValueError нысаны. Бұл жағдайда A функциясы B деп аталады, ол C деп аталады, D және get_age деп аталады . 6-жолдағы көтеру мәлімдемесі бұл нысанды « қайтару мәнінің» түрі ретінде жүзеге асырады және get_age() қызметінен D шақырушысына бірден шығады . Содан кейін D қайтадан өзінің шақырушысына шығады C , ал C В - ге шығады және т.с.с., әрқайсысы ерекше жағдай нысанын шақырушыға қайтарады.көріңіз ... қоспағанда , бұл ерекше жағдайды өңдей алады. Біз мұны «қоңыраулар стегін босату» деп атаймыз.

ValueError - біз көтергіміз келетін қате түріне барынша сәйкес келетін кірістірілген ерекше жағдай түрлерінің бірі. Кірістірілген ерекшеліктердің толық тізімін Python кітапханасының анықтамалығының Кірістірілген ерекшеліктер бөлімінен, оны тағы да Python жасаушысы Гвидо ван Россум жазған.

Get_age деп аталатын функция (немесе оның шақырушысы немесе олардың шақырушысы ...) қатені өңдесе, онда бағдарлама жұмысын жалғастыра алады; әйтпесе, Python кері іздеуді басып шығарады және шығады:

```python
>>> get_age()
Please enter your age: 42
42
>>> get_age()
Please enter your age: -2
Traceback (most recent call last):
  File "<interactive input>", line 1, in <module>
  File "learn_exceptions.py", line 4, in get_age
    raise ValueError("{0} is not a valid age".format(age))
ValueError: -2 is not a valid age
```

Қате туралы хабар ерекше жағдай түрін және ерекше жағдай нысаны алғаш жасалған кезде берілген қосымша ақпаратты қамтиды.

Көбінесе 5 және 6-жолдар (ерекшелік нысанын жасау, содан кейін ерекшелікті көтеру) бір мәлімдемеге біріктіріледі, бірақ шын мәнінде екі түрлі және тәуелсіз нәрсе болып жатыр, сондықтан екі қадамды бөлек ұстау мағынасы бар шығар. біз ерекше жағдайлармен жұмыс істеуді алғаш рет үйренген кезде. Мұнда біз бәрін бір мәлімдемеде көрсетеміз:

```python
raise ValueError("{0} is not a valid age".format(age))
```

## 22.3. Бұрынғы мысалды

Ерекше жағдайды өңдеуді пайдалана отырып, біз енді алдыңғы тараудағы recursion_depth мысалын өзгертуге болады, сонда ол рұқсат етілген ең үлкен рекурсия тереңдігіне жеткенде тоқтайды:

```python
def recursion_depth(number):
    print("Recursion depth number", number)
    try:
        recursion_depth(number + 1)
    except:
        print("I cannot go any deeper into this wormhole.")

recursion_depth(0)
```

Осы нұсқаны іске қосыңыз және нәтижелерді қадағалаңыз.

## 22.4. try мәлімдемесінің соңғы тармағы

Бағдарламалаудың жалпы үлгісі - қандай да бір ресурсты алу — мысалы, біз тасбақаларға сурет салу үшін терезе жасаймыз немесе интернет провайдеріне қосылым жасаймыз немесе жазу үшін файлды аша аламыз. Содан кейін біз кейбір есептеулерді орындаймыз, ол ерекшелік тудыруы мүмкін немесе ешбір қиындықсыз жұмыс істей алады.

Қандай жағдай болмасын, біз басып алған ресурстарды «тазартқымыз» келеді — мысалы, терезені жабу, теру қосылымын ажырату немесе файлды жабу. try мәлімдемесінің соңғы тармағы - мұны істеу жолы. Мына (біраз ойдан шығарылған) мысалды қарастырыңыз:

```python
import turtle
import time

def show_poly():
    try:
        win = turtle.Screen()   # Grab/create a resource, e.g. a window
        tess = turtle.Turtle()

        # This dialog could be cancelled,
        #   or the conversion to int might fail, or n might be zero.
        n = int(input("How many sides do you want in your polygon?"))
        angle = 360 / n
        for i in range(n):      # Draw the polygon
            tess.forward(10)
            tess.left(angle)
        time.sleep(3)           # Make program wait a few seconds
    finally:
        win.bye()               # Close the turtle's window

show_poly()
show_poly()
show_poly()
```

20–22 жолдарда show_poly үш рет шақырылады. Әрқайсысы тасбақа үшін жаңа терезе жасайды және пайдаланушы енгізген жақтардың саны бар көпбұрышты салады. Бірақ егер пайдаланушы int түрлендіруге болмайтын жолды енгізсе ше? Егер олар диалогты жапса ше? Ерекшелік аламыз, бірақ бізде ерекше жағдай болғанымен, біз әлі де тасбақа терезесін жапқымыз келеді . 17-18 жолдар мұны біз үшін жасайды. Біз try тармағындағы мәлімдемелерді сәтті аяқтадық па, жоқ па , finally блогы әрқашан орындалады.

Ерекшелік әлі өңделмегеніне назар аударыңыз — тек except тармағы ерекше жағдайды өңдей алады, сондықтан бағдарламамыз әлі де бұзылады. Бірақ кем дегенде тасбақаның терезесі құламай тұрып жабылады!

## 22.5. Глоссарий 
ерекшелік
Орындалу уақытында пайда болатын қате.
ерекше жағдайды өңдеңіз
Ерекше жағдайдың бағдарламамыздың бұзылуына әкеліп соғуын болдырмау үшін код блогын сынап көру арқылы орау арқылы ... конструкциядан басқа .
көтеру
yükseltme мәлімдемесін пайдалану арқылы әдейі ерекше жағдай жасау үшін .

## 22.6. Жаттығулар 
Пайдаланушыдан оң бүтін санды сұрау үшін енгізу тілқатысу терезесін пайдаланатын , содан кейін талаптарға сәйкес келетінін растау үшін енгізуді тексеретін readposint деп аталатын функцияны жазыңыз . Ол int түріне түрлендіруге болмайтын кірістерді , сондай-ақ теріс int s және шеткі жағдайларды өңдеуге қабілетті болуы керек (мысалы, пайдаланушы диалогты жапқанда немесе мүлде ештеңе енгізбегенде).

