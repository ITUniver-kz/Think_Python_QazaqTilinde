---
title: Мұрагерлік
isFree: True
---

# 21. Мұрагерлік


## 21.1. Мұрагерлік

Объектіге бағытталған бағдарламалаумен жиі байланысты тіл ерекшелігі мұра болып табылады . Мұрагерлік – бұрыннан бар сыныптың өзгертілген нұсқасы болып табылатын жаңа сыныпты анықтау мүмкіндігі.

Бұл мүмкіндіктің негізгі артықшылығы бар сыныпты өзгертпей-ақ сыныпқа жаңа әдістерді қосуға болады. Ол мұра деп аталады, себебі жаңа класс бар сыныптың барлық әдістерін мұра етеді. Бұл метафораны кеңейте отырып, бар сынып кейде ата- аналық класс деп аталады. Жаңа сыныпты еншілес сынып немесе кейде қосалқы сынып деп атауға болады .

Мұрагерлік - күшті қасиет. Мұрагерліксіз күрделі болатын кейбір бағдарламаларды онымен қысқа және қарапайым жазуға болады. Сондай-ақ, мұра кодты қайта пайдалануды жеңілдетеді, өйткені ата-аналық сыныптардың әрекетін оларды өзгертусіз теңшеуге болады. Кейбір жағдайларда мұрагерлік құрылым мәселенің табиғи құрылымын көрсетеді, бұл бағдарламаны түсінуді жеңілдетеді.

Екінші жағынан, мұрагерлік бағдарламаларды оқуды қиындатады. Әдіс шақырылған кезде оның анықтамасын қайдан табуға болатыны кейде түсініксіз болады. Сәйкес код бірнеше модульдер арасында шашыраңқы болуы мүмкін. Сондай-ақ, мұраны пайдалану арқылы жасауға болатын көптеген нәрселерді онсыз талғампаз (немесе одан да көп) жасауға болады. Егер мәселенің табиғи құрылымы мұраға ие болмаса, бағдарламалаудың бұл стилі пайдадан гөрі көп зиян келтіруі мүмкін.

Бұл тарауда біз Old Maid карта ойынын ойнайтын бағдарламаның бөлігі ретінде мұраны пайдалануды көрсетеміз. Біздің мақсаттарымыздың бірі - басқа карта ойындарын жүзеге асыру үшін қайта пайдалануға болатын код жазу.

## 21.2. Карталардың қолы

Кез келген дерлік карта ойыны үшін біз карталардың қолын көрсетуіміз керек. Қол, әрине, палубаға ұқсайды. Екеуі де карталар жиынтығынан тұрады және екеуі де карталарды қосу және жою сияқты операцияларды қажет етеді. Сондай-ақ, бізге палубаларды да, қолдарды да араластыру мүмкіндігі ұнауы мүмкін.

Қолдың да палубадан айырмашылығы бар. Ойнап жатқан ойынға байланысты біз палуба үшін мағынасы жоқ қолдармен кейбір әрекеттерді орындағымыз келуі мүмкін. Мысалы, покерде біз қолды жіктей аламыз (тікелей, тегіс және т.б.) немесе оны басқа қолмен салыстыруымыз мүмкін. Көпірде біз ұсыныс жасау үшін қолдың ұпайын есептегіміз келуі мүмкін.

Бұл жағдай мұраны пайдалануды болжайды. Егер Hand - палубаның ішкі сыныбы болса, онда Deck -тің барлық әдістері болады және жаңа әдістерді қосуға болады.

Біз осы тараудағы кодты алдыңғы тараудағы Cards.py файлымызға қосамыз . Класс анықтамасында ата-аналық сыныптың атауы жақша ішінде көрсетіледі:

```python
class Hand(Deck):
    pass
```

Бұл мәлімдеме жаңа Hand класы бұрыннан бар Deck сыныбынан мұраға алатынын көрсетеді .

Қол конструкторы ат және карталар болып табылатын қол атрибуттарын инициализациялайды . Жол атауы бұл қолды, мүмкін оны ұстап тұрған ойыншының атымен анықтайды. Атау әдепкі мән ретінде бос жолы бар қосымша параметр болып табылады. карталар – бос тізімге инициализацияланған қолдағы карталар тізімі:

```python
class Hand(Deck):
    def __init__(self, name=""):
       self.cards = []
       self.name = name
```

Кез келген карта ойыны үшін палубадан карталарды қосу және алып тастау қажет. Карталарды алып тастау қазірдің өзінде шешілді, өйткені Hand мұрасы палубадан жойылады . Бірақ біз қосуды жазуымыз керек :

```python
class Hand(Deck):
    ...
    def add(self, card):
        self.cards.append(card)
```

Тағы да, эллипс басқа әдістерді өткізіп жібергенімізді көрсетеді. Тізімді қосу әдісі жаңа картаны карталар тізімінің соңына қосады.

## 21.3. Төлем карталары

Енді бізде Hand класы болғандықтан, біз палубадан карталарды қолдарға бергіміз келеді . Бұл әдіс Hand немесе Deck класында болуы керек пе, бірден анық емес, бірақ ол бір палубада және (мүмкін) бірнеше қолдарда жұмыс істейтіндіктен, оны Палубаға қою табиғирақ .

мәміле өте жалпы болуы керек, өйткені әртүрлі ойындарда әртүрлі талаптар болады. Бүкіл палубаны бірден шығарғымыз немесе әр қолға бір карта қосқымыз келуі мүмкін.

мәміле екі параметрді, қолдар тізімін (немесе кортежін) және мәміле жасалатын карталардың жалпы санын алады. Палубада карталар жеткіліксіз болса, әдіс барлық карталарды таратады және тоқтайды:

```python
class Deck:
    ...
    def deal(self, hands, num_cards=999):
        num_hands = len(hands)
        for i in range(num_cards):
            if self.is_empty():
                break                    # Break if out of cards
            card = self.pop()            # Take the top card
            hand = hands[i % num_hands]  # Whose turn is next?
            hand.add(card)               # Add the card to the hand
```

Екінші параметр, карталар_саны , міндетті емес; әдепкі - үлкен сан, бұл палубадағы барлық карталар таратылатынын білдіреді.

i циклінің айнымалы мәні 0-ден 1_cards_санына дейін барады . Әрбір цикл арқылы карта тізімдегі соңғы элементті алып тастайтын және қайтаратын тізім әдісі pop арқылы палубадан жойылады.

Модуль операторы ( % ) бізге карталарды дөңгелек жүйеде (әрбір қолға бір-бір карта) беруге мүмкіндік береді. i тізімдегі қолдар санына тең болғанда , i % сан_қол өрнегі тізімнің басына айналады (индекс 0).

## 21.4. Қолды басып шығару

Қолдың мазмұнын басып шығару үшін біз Deck - тен мұраланған __str__ әдісін пайдалана аламыз . Мысалға:

```python
>>> deck = Deck()
>>> deck.shuffle()
>>> hand = Hand("frank")
>>> deck.deal([hand], 5)
>>> print(hand)
Hand frank contains
2 of Spades
 3 of Spades
  4 of Spades
   Ace of Hearts
    9 of Clubs
```

Бұл тамаша қол емес, бірақ оның тіке шағылыстыратын қасиеттері бар.

Қолданыстағы әдістерді мұраға алу ыңғайлы болғанымен, біз біреуін басып шығарған кезде қосқымыз келетін Hand нысанында қосымша ақпарат бар. Мұны істеу үшін біз Hand класында Палубалық кластағы әдісті қайта анықтайтын __str__ әдісін бере аламыз :

```python
class Hand(Deck)
    ...
    def __str__(self):
        s = "Hand " + self.name
        if self.is_empty():
            s += " is empty\n"
        else:
            s += " contains\n"
        return s + Deck.__str__(self)
```

Бастапқыда s - қолды анықтайтын жол. Қол бос болса, бағдарлама бос сөздерді қосып , s қайтарады .

Әйтпесе, бағдарлама Deck класындағы __str__ әдісін өз бетінше шақыру арқылы есептелетін Deck сөзін және жол көрінісін қосады .

Қолдың палуба түрі екенін есте ұстамайынша, ағымдағы Қолға қатысты self -ті палуба әдісіне жіберу біртүрлі болып көрінуі мүмкін . Қол нысандары палуба нысандарының барлығын жасай алады, сондықтан Қолды палубаға жіберу әдісі заңды.

Жалпы, тектік сынып данасы орнына ішкі сынып данасын пайдалану әрқашан заңды.

## 21.5. CardGame сыныбы

CardGame сыныбы барлық ойындарға ортақ кейбір негізгі тапсырмаларды орындайды, мысалы, палубаны жасау және оны араластыру:

```python
class CardGame:
    def __init__(self):
        self.deck = Deck()
        self.deck.shuffle()
```

Бұл инициализация әдісі атрибуттарды инициализациялаудан тыс маңызды есептеуді орындайтынын көрген бірінші жағдай.

Белгілі бір ойындарды іске асыру үшін біз CardGame ойынынан мұра алып , жаңа ойынға мүмкіндіктер қоса аламыз. Мысал ретінде біз ескі қызметшінің симуляциясын жазамыз.

Ескі қыздың мақсаты - қолыңыздағы карталардан құтылу. Сіз мұны карталарды дәрежесі мен түсі бойынша сәйкестендіру арқылы жасайсыз. Мысалы, Клубтардың 4-і Spades-тің 4-іне сәйкес келеді, өйткені екеуі де қара түсті. Жүрек Джек гауһар Джекке сәйкес келеді, өйткені екеуі де қызыл.

Ойынды бастау үшін Клубтар патшайымы палубадан шығарылады, осылайша Күректер ханшайымында сәйкестік жоқ. Қалған елу бір карта ойыншыларға дөңгелек жүйеде таратылады. Мәміледен кейін барлық ойыншылар сәйкес келеді және мүмкіндігінше көп карталарды тастайды.

Басқа сәйкестіктерді жасау мүмкін болмаған кезде, ойын басталады. Өз кезегінде, әрбір ойыншы сол жақта әлі карталары бар ең жақын көршіден картаны (қарамай) таңдайды. Таңдалған карта ойыншының қолындағы картаға сәйкес келсе, жұп жойылады. Әйтпесе, карта ойыншының қолына қосылады. Ақырында барлық ықтимал матчтар жасалады, жеңілген адамның қолында тек күректер патшайымы қалады.

Ойынның компьютерлік модельдеуінде компьютер барлық қолды ойнайды. Өкінішке орай, нақты ойынның кейбір нюанстары жоғалады. Нағыз ойында ескі қызметші бар ойыншы көршісіне картаны таңдауға тырысады, оны сәл көрнектірек көрсету немесе мүмкін оны анағұрлым көрнекті түрде көрсете алмау немесе тіпті бұл картаны көрсете алмау арқылы. анағұрлым көрнекті. Компьютер көршісінің картасын кездейсоқ таңдайды.

## 21.6. OldMaidHand сыныбы

Old Maid ойнауға арналған қол қолдың жалпы қабілеттерінен тыс кейбір қабілеттерді қажет етеді . Біз Hand - тен мұра алатын және remove_matches деп аталатын қосымша әдісті қамтамасыз ететін OldMaidHand жаңа класын анықтаймыз :

```python
class OldMaidHand(Hand):
    def remove_matches(self):
        count = 0
        original_cards = self.cards[:]
        for card in original_cards:
            match = Card(3 - card.suit, card.rank)
            if match in self.cards:
                self.cards.remove(card)
                self.cards.remove(match)
                print("Hand {0}: {1} matches {2}"
                        .format(self.name, card, match))
                count += 1
        return count
```

Біз карталар тізімінің көшірмесін жасаудан бастаймыз, осылайша біз карталарды түпнұсқадан алып тастаған кезде көшірмені айналдыра аламыз. Self.cards циклде өзгертілгендіктен, оны өтуді басқару үшін пайдаланғымыз келмейді. Python өзгеріп жатқан тізімді айналып өтсе, шатасуы мүмкін!

Қолдағы әрбір карта үшін сәйкес картаның не екенін анықтап, оны іздейміз. Сәйкестік картасының дәрежесі бірдей және сол түсті басқа костюм бар. 3 - card.suit өрнегі Клубты (0 костюм) күрекке (3 костюм) және гауһар тасты (1 костюм) жүрекке (2 костюм) айналдырады. Қарама-қарсы операциялардың да жұмыс істейтініне өзіңізді қанағаттандыруыңыз керек. Егер матч картасы да қолында болса, екі карта да жойылады.

Келесі мысал remove_matches пайдалану жолын көрсетеді :

```python
>>> game = CardGame()
>>> hand = OldMaidHand("frank")
>>> game.deck.deal([hand], 13)
>>> print(hand)
Hand frank contains
Ace of Spades
 2 of Diamonds
  7 of Spades
   8 of Clubs
    6 of Hearts
     8 of Spades
      7 of Clubs
       Queen of Clubs
        7 of Diamonds
         5 of Clubs
          Jack of Diamonds
           10 of Diamonds
            10 of Hearts
>>> hand.remove_matches()
Hand frank: 7 of Spades matches 7 of Clubs
Hand frank: 8 of Spades matches 8 of Clubs
Hand frank: 10 of Diamonds matches 10 of Hearts
>>> print(hand)
Hand frank contains
Ace of Spades
 2 of Diamonds
  6 of Hearts
   Queen of Clubs
    7 of Diamonds
     5 of Clubs
      Jack of Diamonds
```

OldMaidHand сыныбы үшін __init__ әдісі жоқ екенін ескеріңіз. Біз оны Ханнан мұраға аламыз .

## 21.7. OldMaidGame сыныбы

Енді назарымызды ойынның өзіне аударайық. OldMaidGame - параметр ретінде ойыншылар тізімін алатын play деп аталатын жаңа әдісі бар CardGame қосалқы сыныбы .

__init__ CardGame ойынынан мұраланғандықтан , жаңа OldMaidGame нысанында жаңа аралас палуба бар:

```python
class OldMaidGame(CardGame):
    def play(self, names):
        # Remove Queen of Clubs
        self.deck.remove(Card(0,12))

        # Make a hand for each player
        self.hands = []
        for name in names:
            self.hands.append(OldMaidHand(name))

        # Deal the cards
        self.deck.deal(self.hands)
        print("---------- Cards have been dealt")
        self.print_hands()

        # Remove initial matches
        matches = self.remove_all_matches()
        print("---------- Matches discarded, play begins")
        self.print_hands()

        # Play until all 50 cards are matched
        turn = 0
        num_hands = len(self.hands)
        while matches < 25:
            matches += self.play_one_turn(turn)
            turn = (turn + 1) % num_hands

        print("---------- Game is Over")
        self.print_hands()
```

Print_hands жазуы жаттығу ретінде қалдырылды.

Ойынның кейбір қадамдары әдістерге бөлінген. remove_all_matches қолдар тізімін айналып өтіп, әрқайсысында remove_матчтарды шақырады :

```python
class OldMaidGame(CardGame):
    ...
    def remove_all_matches(self):
        count = 0
        for hand in self.hands:
            count += hand.remove_matches()
        return count
```

count — әр қолдағы сіріңкелердің санын қосатын жинақтаушы. Біз әр қолды өткізген кезде, жиынтық қайтарылады ( count ).

Матчтардың жалпы саны жиырма беске жеткенде, қолдардан елу карта алынып тасталды, бұл тек бір карта қалды және ойын аяқталды дегенді білдіреді.

Айнымалы айналым қай ойыншының кезегі екенін қадағалап отырады. Ол 0-ден басталады және әр уақытта бір-бірге артады; ол сан_қолдарына жеткенде , модуль операторы оны 0-ге қайта орайды.

play_one_turn әдісі кезек кімдікі екенін көрсететін параметрді қабылдайды. Қайтару мәні - осы айналым кезінде жасалған сәйкестіктер саны:

```python
class OldMaidGame(CardGame):
    ...
    def play_one_turn(self, i):
        if self.hands[i].is_empty():
            return 0
        neighbor = self.find_neighbor(i)
        picked_card = self.hands[neighbor].pop()
        self.hands[i].add(picked_card)
        print("Hand", self.hands[i].name, "picked", picked_card)
        count = self.hands[i].remove_matches()
        self.hands[i].shuffle()
        return count
```

Егер ойыншының қолы бос болса, ол ойыншы ойыннан тыс қалады, сондықтан ол ештеңе істемейді және 0 қайтарады.

Әйтпесе, кезек сол жақта карталары бар бірінші ойыншыны табудан, көршіден бір картаны алудан және матчтардың бар-жоғын тексеруден тұрады. Қайтару алдында қолдағы карталар келесі ойыншының таңдауы кездейсоқ болатындай етіп араластырылады.

find_neighbor әдісі сол жақтағы ойыншыдан басталады және әлі де карталары бар ойыншыны тапқанша шеңбер бойымен жалғасады:

```python
class OldMaidGame(CardGame):
    ...
    def find_neighbor(self, i):
        num_hands = len(self.hands)
        for next in range(1,num_hands):
            neighbor = (i + next) % num_hands
            if not self.hands[neighbor].is_empty():
                return neighbor
```

Егер find_neighbor шеңбер бойымен карталарды таппай жүрсе, ол None қайтарады және бағдарламаның басқа жерінде қатені тудырады. Бақытымызға орай, біз бұл ешқашан болмайтынын дәлелдей аламыз (ойынның соңы дұрыс анықталған кезде).

Біз print_hands әдісін өткізіп жібердік. Сіз мұны өзіңіз жаза аласыз.

Келесі нәтиже үш ойыншыға тек ең жақсы он бес карта (ондық және одан жоғары) таратылатын ойынның қысқартылған түрінен алынған. Бұл шағын палубамен ойын жиырма бес емес, жеті матчтан кейін тоқтайды.

```python
>>> import cards
>>> game = cards.OldMaidGame()
>>> game.play(["Allen","Jeff","Chris"])
---------- Cards have been dealt
Hand Allen contains
King of Hearts
 Jack of Clubs
  Queen of Spades
   King of Spades
    10 of Diamonds

Hand Jeff contains
Queen of Hearts
 Jack of Spades
  Jack of Hearts
   King of Diamonds
    Queen of Diamonds

Hand Chris contains
Jack of Diamonds
 King of Clubs
  10 of Spades
   10 of Hearts
    10 of Clubs

Hand Jeff: Queen of Hearts matches Queen of Diamonds
Hand Chris: 10 of Spades matches 10 of Clubs
---------- Matches discarded, play begins
Hand Allen contains
King of Hearts
 Jack of Clubs
  Queen of Spades
   King of Spades
    10 of Diamonds

Hand Jeff contains
Jack of Spades
 Jack of Hearts
  King of Diamonds

Hand Chris contains
Jack of Diamonds
 King of Clubs
  10 of Hearts

Hand Allen picked King of Diamonds
Hand Allen: King of Hearts matches King of Diamonds
Hand Jeff picked 10 of Hearts
Hand Chris picked Jack of Clubs
Hand Allen picked Jack of Hearts
Hand Jeff picked Jack of Diamonds
Hand Chris picked Queen of Spades
Hand Allen picked Jack of Diamonds
Hand Allen: Jack of Hearts matches Jack of Diamonds
Hand Jeff picked King of Clubs
Hand Chris picked King of Spades
Hand Allen picked 10 of Hearts
Hand Allen: 10 of Diamonds matches 10 of Hearts
Hand Jeff picked Queen of Spades
Hand Chris picked Jack of Spades
Hand Chris: Jack of Clubs matches Jack of Spades
Hand Jeff picked King of Spades
Hand Jeff: King of Clubs matches King of Spades
---------- Game is Over
Hand Allen is empty

Hand Jeff contains
Queen of Spades

Hand Chris is empty
```

Осылайша Джефф жеңіледі.

## 21.8. Глоссарий 
мұрагерлік
Бұрын анықталған сыныптың өзгертілген нұсқасы болып табылатын жаңа сыныпты анықтау мүмкіндігі.
ата-аналар сыныбы
Балалар класы мұрагер болатын сынып.
бала сыныбы
Бар сыныптан мұра алу арқылы жасалған жаңа класс; қосалқы класс деп те атайды.

## 21.9. Жаттығулар

Self.hands арқылы өтетін және әр қолды басып шығаратын OldMaidGame сыныбына print_hands әдісін қосыңыз .
Кейбір қосымша мүмкіндіктермен бірге келетін TurtleGTX түрінің жаңа түрін анықтаңыз : ол берілген қашықтыққа алға секіре алады және тасбақа өндіріс желісінен шыққаннан бері қанша жол жүргенін қадағалайтын одометрі бар. (Ата-аналық сыныпта fd , forward , back , backward және bk сияқты бірқатар синонимдер бар : бұл жаттығу үшін тек осы функцияны алға қоюға назар аударыңызәдісі.) Тасбақа теріс мөлшерге алға жылжу сұралса, қашықтықты қалай санау керектігін мұқият ойластырыңыз. (Одометр көрсеткіші жалған болған екінші қолдан жасалған тасбақаны сатып алғымыз келмейді, себебі оның бұрынғы иесі оны тым жиі блоктың айналасында артқа қарай айдады. Мұны сізге жақын көлікте қолданып көріңіз және сіз көліктің одометрі жоғары немесе төмен санайтынын көріңіз. кері.)
Кездейсоқ қашықтықты жүріп өткеннен кейін тасбақа доңғалақ жарылып сынуы керек. Бұл орын алған соң, forward шақырылғанда ерекше жағдайды көтеріңіз . Сондай-ақ пәтерді жөндей алатын өзгерту_шина әдісін қамтамасыз етіңіз.

