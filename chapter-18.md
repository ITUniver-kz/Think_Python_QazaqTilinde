---
title: Кластар мен объектілер. Тереңірек қарастыру
isFree: true
---

# 18. Кластар мен объектілер. Тереңірек қарастыру / Classes and Objects — Digging a little deeper

## 18.1. Тіктөртбұрыштар

Біз класс XY жазықтығының бір жерінде орналасқан тіктөртбұрышты көрсеткіміз келеді делік. Мәселе мынада, мұндай тіктөртбұрышты көрсету үшін бізге қандай мәндер беру керек? Біздің тапсырманы қарапайым жасау үшін, тіктөртбұрыш ешқашан бұрышқа жантайып емес, тек тігінен немесе көлденеңінен бағытталған деп есептеңіз.

Бірнеше мүмкіндіктер бар: біз тіктөртбұрыштың ортасын (екі координат) және оның өлшемін (ені мен биіктігін) көрсете аламыз; немесе бұрыштардың бірін және өлшемін белгілей аламыз; немесе қарама-қарсы екі бұрышты белгілей аламыз. Дұрыс таңдау тіктөртбұрыштың сол жақ жоғарғы бұрышын және өлшемін көрсету болып табылады.

Біз тағы да жаңа классты анықтаймыз және оны инициализатормен және тіркесті түрлендіргіш әдісімен қамтамасыз етеміз:

```python
class Rectangle:
    """ A class to manufacture rectangle objects 
        Тіктөртбұрыш объектілерін жасауға арналған класс
    """

    def __init__(self, posn, w, h):
        """ Initialize rectangle at posn, with width w, height h 
            Тіктөртбұрышты posn позицияда инициализациялаңыз, және ені w, биіктігі h
        """
        self.corner = posn
        self.width = w
        self.height = h

    def __str__(self):
        return  "({0}, {1}, {2})"
                  .format(self.corner, self.width, self.height)

box = Rectangle(Point(0, 0), 100, 200)
bomb = Rectangle(Point(100, 80), 5, 10)    # In my video game Менің видео ойында
print("box: ", box)
print("bomb: ", bomb)
```

Жоғарғы сол жақ бұрышты көрсету үшін біз жаңа ```Rectangle``` объектісінің ішіне ```Point``` объектісін (алдыңғы тарауда қолданғанымыздай) ендірдік! Біз екі жаңа ```Rectangle``` объектісін жасаймыз, содан кейін оларды басып шығарамыз:

```python
box: ((0, 0), 100, 200)
bomb: ((100, 80), 5, 10)
```

Нүкте операторы осының барлығын құрастырады. ```box.corner.x``` өрнегі "```box``` сілтеме жасайтын объектіге өтіп, оның ```corner``` (_бұрыш_) деп аталатын атрибутын таңдаңыз, содан кейін ```corner``` объектіге өтіп, оның ```x``` деп аталатын атрибутын таңдаңыз" дегенді білдіреді.

Суретте осы объекттің күйі көрсетілген:

![box](https://user-images.githubusercontent.com/84173441/177078841-923fa336-8c2b-4b7a-b964-1c54a1ecceed.JPG)


## 18.2. Объектілер өзгермелі

Біз объектінің атрибуттарының біріне тағайындау жасау арқылы оның күйін өзгерте аламыз. Мысалы, тіктөртбұрыштың орнын өзгертпестен оның өлшемін үлкейту үшін ені мен биіктігінің мәндерін өзгертуге болады:

```python
box.width += 50
box.height += 100
```

Әрине, біз оны класс ішіне инкапсуляциялау үшін әдіс жазғымыз келетін шығар. Тіктөртбұрыштың орнын басқа жерге жылжытуға арналған тағы бір әдіс жазамыз:

```python
class Rectangle:
    """ A class to manufacture rectangle objects 
        Тіктөртбұрыш объектілерін жасауға арналған класс
    """

    def __init__(self, posn, w, h):
        """ Initialize rectangle at posn, with width w, height h 
            Тіктөртбұрышты posn позицияда инициализациялаңыз, және ені w, биіктігі h
        """
        self.corner = posn
        self.width = w
        self.height = h

    def __str__(self):
        return  "({0}, {1}, {2})"
                  .format(self.corner, self.width, self.height)

    def grow(self, delta_width, delta_height):
        """ Grow (or shrink) this object by the deltas 
            Бұл объектіні дельта бойынша өсіріңіз (немесе кішірейтіңіз).
        """
        self.width += delta_width
        self.height += delta_height

    def move(self, dx, dy):
        """ Move this object by the deltas 
            Осы объектіні дельта бойынша жылжытыңыз
        """
        self.corner.x += dx
        self.corner.y += dy
```

Мынаны қолданып көрейік:

```python
>>> r = Rectangle(Point(10,5), 100, 50)
>>> print(r)
((10, 5), 100, 50)
>>> r.grow(25, -10)
>>> print(r)
((10, 5), 125, 40)
>>> r.move(-10, 10)
print(r)
((0, 15), 125, 40)
```

## 18.3. Бірдейлік

«Бірдей» сөзінің мағынасы біз оған біраз ойланбайынша, өте түсінікті болып көрінеді, содан кейін біз оның бастапқыда күткенімізден де көп мағыналы екенін түсінеміз.

Мысалы, «Алиса мен Бобтың көлігі бірдей» десек, демек олардың көлігінің маркасы мен үлгісі бірдей, бірақ олар екі түрлі көлік екенін білдіреді. «Алиса мен Бобтың анасы бір» десек, олардың анасы бір адам екенін білдіреді.

Объектілер туралы айтқанда, ұқсас түсініксіздік бар. Мысалы, егер екі ```Point``` бірдей болса, бұл олардың бірдей деректерден (координаталар) тұратынын немесе олардың шын мәнінде бір нысан екенін білдіре ме?

Біз ```is``` операторын тізімдер тарауында көрдік, онда біз бүркеншік аттар туралы айттық: ол бізге екі сілтеме бір объектіге сілтеме жасайды ма анықтауға мүмкіндік береді:

```python
>>> p1 = Point(3, 4)
>>> p2 = Point(3, 4)
>>> p1 is p2
False
```

```p1``` және ```p2``` бірдей координаттарды қамтығанмен, олар бір объект емес. Егер ```p1``` мәнін ```p3``` мәніне тағайындасақ, онда екі айнымалы бір объектінің бүркеншік аттары болады:

```python
>>> p3 = p1
>>> p1 is p3
True
```

Теңдіктің бұл түрі **shallow equality** (таяз теңдік) деп аталады , өйткені ол объектілердің мазмұнын емес, тек сілтемелерді салыстырады.

Объектілердің мазмұнын салыстыру үшін — **deep equality** (терең теңдік) — ```same_coordinates``` деп аталатын функцияны жаза аламыз:

```python
def same_coordinates(p1, p2):
    return (p1.x == p2.x) and (p1.y == p2.y)
```

Енді біз бірдей деректерден тұратын екі түрлі объектіні жасасақ, олардың координаталары бірдей нүктелерді көрсететінін анықтау үшін ```same_coordinates``` пайдалана аламыз.

```python
>>> p1 = Point(3, 4)
>>> p2 = Point(3, 4)
>>> same_coordinates(p1, p2)
True
```

Әрине, егер екі айнымалы бір объектіге сілтеме жасаса, олардың таяз және терең теңдігі болады.

---

**== сақ болыңыз**

«Мен сөзді қолданғанда, - деді Хамти Дампти, мысқылмен, - бұл мен таңдаған нәрсені ғана білдіреді - артық та емес, кем де емес». _Алиса ғажайыптар елінде_

Python, класс дизайнеріне == немесе < сияқты операцияның нені білдіретінін шешуге мүмкіндік беретін қуатты мүмкіндікке ие. (Біз жаңа ғана өз объектілеріміздің тіркеске қалай түрленетінін қалай басқара алатынымызды көрсеттік, сондықтан біз қазірдің өзінде кірістік!) Толығырақ кейінірек қарастырамыз. Бірақ кейде орындаушылар осы шағын экспериментте көрсетілгендей таяз теңдік семантикасын, ал кейде терең теңдікті қосады:

```python
p = Point(4, 2)
s = Point(4, 2)
print("== on Points returns", p == s)
# By default, == on Point objects does a shallow equality test
# Әдепкі бойынша, == Point нысандарында таяз теңдік сынағын жасайды

a = [2,3]
b = [2,3]
print("== on lists returns", a == b)
# But by default, == does a deep equality test on lists
# Бірақ әдепкі бойынша == тізімдерде терең теңдік сынағын жасайды
```

Бұл мынаны шығарады:

```python
== on Points returns False
== on lists returns True
```

Сонымен, екі тізім (немесе кортеждер және т.б.) жады мекенжайлары әр түрлі бөлек объекттер болса да, тізімдер үшін == операторы терең теңдікке сынақ жүргізеді, ал нүктелер жағдайында ол таяз сынақ жасайды деген қорытындыға келдік.

---

## 18.4. Көшіру

Бүркеншік ат қою бағдарламаны оқуды қиындатады, себебі бір жерде жасалған өзгертулер басқа жерде күтпеген әсер етуі мүмкін. Берілген объектіге сілтеме жасай алатын барлық айнымалыларды қадағалау қиын.

Объектіні көшіру көбінесе бүркеншік атқа балама болып табылады. ```copy``` модулінде кез келген объектіні көшіре алатын ```copy``` деп аталатын функция бар :

```python
>>> import copy
>>> p1 = Point(3, 4)
>>> p2 = copy.copy(p1)
>>> p1 is p2
False
>>> same_coordinates(p1, p2)
True
```

```copy``` модулін импорттағаннан кейін біз жаңа ```Point``` жасау үшін ```copy``` функциясын пайдалана аламыз. ```p1``` және ```p2``` бір нүкте емес, бірақ олар бірдей деректерді қамтиды.

Ешбір енгізілген объектілері жоқ ```Point``` сияқты қарапайым объектілерді көшіру үшін ```copy``` жеткілікті. Бұл таяз көшіру деп аталады.

```Point```-қа сілтемесі бар ```Rectangle``` сияқты нәрсе үшін ```copy``` дұрыс әрекет етпейді. Ол ```Point``` объектісіне сілтемені көшіреді, сондықтан ескі ```Rectangle``` және жаңасы бір ```Point```-қа сілтеме жасайды.

Егер біз әдеттегідей ```b1``` қорабын жасап, одан кейін ```copy``` арқылы ```b2``` көшірмесін жасасақ, нәтижесінде күй диаграммасы келесідей болады:

![b2](https://user-images.githubusercontent.com/84173441/177088735-bb92ea1d-c67d-4842-a5cf-3a8c6634ccc8.JPG)

Бұл, әрине, біз қалаған нәрсе емес. Бұл жағдайда, ```Rectangle``` объектісінің бірінде ```grow```-ды (өсуді) шақыру екіншісіне әсер етпейді, бірақ ```move``` шақыру екеуіне де әсер етеді! Бұлай жұмыс жасау принципі шатастырады және қателесуге бейім. Таяз көшірме бұрышты көрсететін ```Point```-қа бүркеншік атты жасады.

Бақытымызға орай, ```copy``` модулінде объектіні ғана емес, сонымен қатар кез келген енгізілген объектілерді да көшіретін ```deepcopy``` (терең көшірме) деп аталатын функция бар. Бұл операция **deep copy** (терең көшірме) деп аталатынын білу таңқаларлық емес.

```python
>>> b2 = copy.deepcopy(b1)
```

Енді ```b1``` және ```b2``` мүлдем бөлек объектілер.

# 18.5. Глоссарий

терең көшірме / **deep copy**
Объектінің мазмұнын, сондай-ақ кез келген енгізілген объектілерді және оларға енгізілген кез келген объектілерді және т.с.с көшіру үшін; ```copy``` модуліндегі ```deepcopy``` функциясы арқылы жүзеге асырылады.

терең теңдік / **deep equality**
Бірдей мәндерді қамтитын объектілерге сілтеме жасайтын екі сілтеменің, немесе мәндердің теңдігі

таяз көшірме / **shallow copy**
Объектілердің мазмұнын көшіру үшін, енгізілген объектілерге сілтемелердің кез-келгенін қоса; ```copy``` модуліндегі ```copy``` функциясы арқылы жүзеге асырылады.

таяз теңдік / **shallow equality**
Сілтемелердің теңдігі немесе бір объектіні көрсететін екі сілтеме.

## 18.6. Жаттығулар

1. ```Rectangle``` классына кез-келген дананың аумағын қайтаратын  ```area``` әдісін қосыңыз:

```python
r = Rectangle(Point(0, 0), 10, 5)
test(r.area() == 50)
```

2. Кез келген тіктөртбұрыш данасының периметрін табу үшін ```Rectangle``` класында ```perimeter``` әдісін жазыңыз:

```python
r = Rectangle(Point(0, 0), 10, 5)
test(r.perimeter() == 30)
```

3. ```Rectangle``` класында кез-келген тіктөртбұрыш данасының ені мен биіктігін ауыстыратын ```swap``` (ауыстыру) әдісін жазыңыз:

```python
r = Rectangle(Point(100, 50), 10, 5)
test(r.width == 10 and r.height == 5)
r.flip()
test(r.width == 5 and r.height == 10)
```

4. ```Point``` тіктөртбұрышқа түсетінін тексеру үшін Rectangle класында жаңа әдісті жазыңыз. Бұл жаттығу үшін ені 10 және биіктігі 5 болатын (0,0) тіктөртбұрыштың ені мен биіктігі бойынша ашық жоғарғы шекаралары бар деп есептейік, яғни ол х бағытында \[0-ден 10-ға дейін созылады), мұнда 0 қосылған, бірақ 10 алынып тасталады және \[0-ден 5) y бағытында. Демек, ол (10, 2) нүктесін қамтымайды. Бұл сынақтардан өту керек:

```python
r = Rectangle(Point(0, 0), 10, 5)
test(r.contains(Point(0, 0)))
test(r.contains(Point(3, 3)))
test(not r.contains(Point(3, 7)))
test(not r.contains(Point(3, 5)))
test(r.contains(Point(3, 4.99999)))
test(not r.contains(Point(-3, -3)))
```

5. Ойындарда біз көбінесе спрайттардың айналасына тікбұрышты «шектеу қорабын» қоямыз. (Спрайт - бұл ойында қозғала алатын объект, біз жақын арада көреміз.) Содан кейін біз бомбалар мен ғарыш кемелерінің тіктөртбұрыштарының кез келген жерде қабаттасатынын салыстыру арқылы _соқтығысуды анықтай_ аламыз.

Екі тіктөртбұрыштың соқтығысатынын анықтау функциясын жаз. _Кеңес: бұл өте қиын жаттығу болуы мүмкін! Кодтау алдында барлық жағдайларды мұқият ойластырыңыз._

